# 《+1》居间交易平台 — 居间人端开发进度评估报告

> 评估时间：2026-02-10
> 需求依据：《+1》平台.xlsx、《+1》居间交易平台页面规划方案.docx

---

## 一、模块总览

| # | 功能模块 | 需求开发进度 |
|---|---------|:-----------:|
| 1 | 注册与认证 | 70% |
| 2 | 首页（Dashboard） | 85% |
| 3 | 商品池（浏览接单） | 80% |
| 4 | 商品详情 | 85% |
| 5 | 买家信息填写与管理 | 90% |
| 6 | 订单发布与竞标管理 | 75% |
| 7 | 保证金支付 | 85% |
| 8 | 合同上传与管理 | 75% |
| 9 | 履约执行与物流 | 70% |
| 10 | 订单详情页 | 80% |
| 11 | 订单列表与搜索 | 85% |
| 12 | 佣金明细 | 80% |
| 13 | PK奖池 | 75% |
| 14 | 平台红包 | 75% |
| 15 | 心愿目标 | 75% |
| 16 | 六边形身价（雷达图） | 70% |
| 17 | 分销推广 | 70% |
| 18 | 个人中心（收入看板） | 80% |
| 19 | 账号设置 | 50% |
| 20 | 站内即时通讯（IM） | 0% |
| 21 | 消息通知与推送 | 0% |
| **综合** | | **约 65%** |

---

## 二、各模块详细评估

---

### 1. 注册与认证

**需求描述：** 手机号验证码登录，选择个人/公司居间人类型，个人需身份证+人脸识别，公司需营业执照+法人身份证，签署《平台协议》和《履约保证金规则》。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_auth/jj_auth.vue` |
| 后端控制器 | `JjAgent.php`（profile相关方法） |
| 数据库表 | `fa_jj_agent_profile` |

**已完成：**
- 认证类型选择（个人/公司）
- 手机号验证码输入
- 身份证正反面上传（OCR识别区域）
- 营业执照上传（公司类型）
- 协议勾选

**未完成：**
- 人脸识别活体检测集成（第三方SDK对接）
- OCR识别结果回显与自动填充
- 后端认证审核流程（平台端审核接口）

**进度：70%**

---

### 2. 首页（Dashboard）

**需求描述：** 展示用户信息、六边形身价雷达图、收入卡片（待结算/已结算/累计）、快捷入口（商品池/竞标/订单/新手指南）、待办事项列表。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_main/jj_main.vue`（Tab容器） |
| 前端组件 | `jj-home-content.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/components/jj-home-content/） |
| 前端独立页 | `pages/jj/jj_home/jj_home.vue` |
| 后端控制器 | `JjAgent.php` → `dashboard()` |
| 数据库表 | `fa_jj_agent_profile`、`fa_jj_order` |

**已完成：**
- 用户头像与昵称展示（支持远程头像）
- 信誉评分展示
- 六边形雷达图（含数值标注）
- 收入卡片（待结算/已结算/累计，含单位标注）
- 快捷入口（商品池/竞标/订单/新手指南）
- 待办事项列表（动态构建 + 点击跳转到对应订单状态）
- PC端侧边栏适配

**未完成：**
- 新手指南页面实际内容（当前显示"功能开发中"）
- PK奖池入口卡片（首页快捷展示）

**进度：85%**

---

### 3. 商品池（浏览接单）

**需求描述：** 按品类、佣金比例筛选工厂产品列表，展示产品名称、价格、佣金比例、工厂信息。

| 类型 | 文件路径 |
|------|---------|
| 前端组件 | `jj-products-content.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/components/jj-products-content/） |
| 前端独立页 | `pages/jj/jj_products/jj_products.vue` |
| 后端控制器 | `JjProduct.php` → `index()` |
| 数据库表 | `fa_jj_product`、`fa_jj_factory` |

**已完成：**
- 产品列表展示（封面图、名称、价格、佣金比例）
- 分页加载更多
- 关键词搜索
- 点击进入产品详情

**未完成：**
- 品类筛选下拉（category_id参数后端已支持，前端筛选UI未做）
- 佣金比例区间筛选

**进度：80%**

---

### 4. 商品详情

**需求描述：** 展示商品主图、基本信息（品名/工艺标准/检测报告/库存/佣金比例）、工厂信息（企业名称/履约率）、产能佣金展示（含警示条）、【立即接单】和【联系厂家】按钮。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `jj_product_detail.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_product_detail/） |
| 后端控制器 | `JjProduct.php` → `detail()` |
| 数据库表 | `fa_jj_product`、`fa_jj_factory` |

**已完成：**
- 商品主图展示
- 价格、佣金比例、库存展示
- 产能佣金展示（服务端计算，含警示条"以上仅为预估金额"）
- 品类、工艺标准、库存信息行
- 工厂信息（企业名称、履约率）
- 【立即接单】按钮 → 跳转买家信息页
- 【联系厂家】按钮入口

**未完成：**
- 检测报告查看（当前提示"暂无检测报告"）
- 【联系厂家】跳转IM（IM模块未开发）

**进度：85%**

---

### 5. 买家信息填写与管理

**需求描述：** 填写企业名称、收货地址、联系人、联系电话、企业信用代码、税务登记证号；支持保存常用买家，接单时弹框选择已保存买家。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_buyer_form/jj_buyer_form.vue` |
| 前端页面 | `pages/jj/jj_buyer_manage/jj_buyer_manage.vue` |
| 后端控制器 | `JjBuyerInfo.php` → `index()` / `add()` / `delete()` |
| 数据库表 | `fa_jj_buyer_info` |

**已完成：**
- 接单页弹框选择已保存买家
- 弹框内新增买家表单（6个字段）
- 选中后自动填充表单
- 买家管理独立页面（列表+新增+删除）
- 默认买家标记
- "我的"菜单入口
- 后端完整CRUD接口
- pages.json路由注册

**未完成：**
- 收货地址省市区三级联动选择器（当前为纯文本输入）
- 企业信用代码18位格式校验（后端）

**进度：90%**

---

### 6. 订单发布与竞标管理

**需求描述：** 居间人可发起竞标，选择1~5家目标工厂，填写需求表单（品类/数量/期望时间/目标佣金/买家信息），发布后工厂收到竞标邀请并报价，居间人对比报价后选定工厂。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_bid_publish/jj_bid_publish.vue` |
| 前端页面 | `jj_bid_board.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_bid_board/） |
| 前端页面 | `jj_bid_detail.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_bid_detail/） |
| 后端控制器 | `JjBid.php` → `factory_list()` / `publish()` / `list()` / `detail()` / `select_factory()` |
| 数据库表 | `fa_jj_bid`、`fa_jj_bid_quote`、`fa_jj_factory` |

**已完成：**
- 竞标发布表单（工厂多选、品类、数量、期望时间、目标佣金、买家信息）
- 竞标看板列表（竞标状态、工厂报价数/总数进度条、倒计时）
- 竞标详情页（需求摘要、报价列表对比、倒计时自动递减）
- 【选定工厂】操作
- 后端完整接口（发布/列表/详情/选定）

**未完成：**
- 工厂筛选器（按省份/地区/行业筛选，当前为全量列表）
- 报价横向表格对比视图（当前为纵向卡片列表）
- 72小时内修改报价（工厂端功能）

**进度：75%**

---

### 7. 保证金支付

**需求描述：** 展示锁定佣金、保证金比例、应缴保证金金额，支持微信/支付宝支付，支付成功后跳转合同上传页。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `jj_deposit.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_deposit/） |
| 后端控制器 | `JjOrder.php` → `deposit_info()` / `pay_deposit()` |
| 数据库表 | `fa_jj_deposit`、`fa_jj_order` |

**已完成：**
- 订单摘要展示（商品名、买家、佣金比例）
- 保证金明细（锁定佣金、比例、应缴金额 — 服务端计算）
- 微信/支付宝支付方式选择
- 《履约保证协议》勾选
- 支付流程（含微信H5/小程序支付、Debug模拟支付）
- 支付成功后跳转合同上传页

**未完成：**
- 红包抵扣保证金功能（后端RedPacket已有deduct逻辑，前端未展示抵扣入口）

**进度：85%**

---

### 8. 合同上传与管理

**需求描述：** 24小时倒计时内上传PDF买卖合同（≤10MB），逾期未传则保证金自动划转给工厂，上传后进入履约执行期。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_contract/jj_contract.vue` |
| 后端控制器 | `JjOrder.php` → `contract_status()` / `submit_contract()` |
| 数据库表 | `fa_jj_contract`、`fa_jj_order` |

**已完成：**
- 合同上传倒计时展示
- PDF文件上传
- 合同状态查询
- 上传成功后状态变更

**未完成：**
- 逾期自动划转保证金（需后端定时任务/Cron）
- 电子签集成（腾讯电子签/法大大 — 需求标注为"可选"）
- 合同审核工厂端操作（工厂端功能）

**进度：75%**

---

### 9. 履约执行与物流

**需求描述：** 履约期倒计时，查看工厂发货状态，物流跟踪，支持平台物流（含返佣）和自提两种方式，需上传收发货清单。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_logistics/jj_logistics.vue` |
| 后端控制器 | `JjOrder.php` → `logistics_info()` / `upload_checklist()` |
| 数据库表 | `fa_jj_logistics`、`fa_jj_order` |

**已完成：**
- 物流信息展示（物流公司、运单号、状态时间线）
- 发货/签收状态节点
- 收发货清单上传功能
- 平台物流/自提类型区分
- 物流返佣金额展示

**未完成：**
- 物流公司下拉选择（极速达/佣金王/省钱王 — 当前为文本展示）
- 实时物流轨迹追踪（第三方物流API对接）
- 自提收货单模板强制校验（买方盖章/工厂盖章/身份证号）

**进度：70%**

---

### 10. 订单详情页

**需求描述：** 状态横幅、订单信息摘要、佣金锁定展示、金额明细（基础佣金/厂家奖金/物流返佣/预计总额）、履约倒计时、三流进度（合同流/资金流/物流流）、操作按钮。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_order_detail/jj_order_detail.vue` |
| 后端控制器 | `JjOrder.php` → `detail()` |
| 数据库表 | `fa_jj_order`、`fa_jj_deposit`、`fa_jj_contract`、`fa_jj_logistics` |

**已完成：**
- 8种状态横幅（待确认→已结算→已取消/已逾期）
- 订单信息摘要（商品、买家、订单号、时间）
- 佣金锁定横幅
- 金额明细（基础佣金/厂家奖金/物流返佣/预计总额 — 全部服务端返回）
- 厂家奖金详情展开区
- 物流返佣详情展开区
- 履约倒计时（合同上传/履约执行两阶段）
- 三流进度展示（合同流/资金流/物流流）
- 操作按钮（缴保证金/上传合同/查看物流/催促工厂）
- 已结算标识

**未完成：**
- 厂家奖金规则从服务端动态获取（当前默认空数组，需工厂端配置后联动）
- 完税凭证PDF下载链接

**进度：80%**

---

### 11. 订单列表与搜索

**需求描述：** 按状态Tab筛选订单（全部/待缴保证金/待上传合同/履约中/待结算/已结算），支持搜索。

| 类型 | 文件路径 |
|------|---------|
| 前端组件 | `jj-orders-content.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/components/jj-orders-content/） |
| 前端独立页 | `pages/jj/jj_orders/jj_orders.vue` |
| 后端控制器 | `JjOrder.php` → `index()` |
| 数据库表 | `fa_jj_order` |

**已完成：**
- 状态Tab切换
- 订单卡片列表（商品、买家、佣金、状态标签）
- 分页加载更多
- 关键词搜索
- 从首页待办事项带状态跳转
- initTab属性支持外部指定初始Tab

**未完成：**
- 订单排序选项（按时间/金额）

**进度：85%**

---

### 12. 佣金明细

**需求描述：** 佣金汇总（待结算/已到账/累计），按状态筛选佣金记录列表，每条记录可展开查看佣金构成（基础佣金/厂家奖金/物流返佣/PK奖池/平台红包）。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `jj_commission.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_commission/） |
| 后端控制器 | `JjCommission.php` → `summary()` / `list()` |
| 数据库表 | `fa_jj_commission` |

**已完成：**
- 汇总卡片（待结算/已到账/累计 — 默认值已修正为0）
- 状态Tab切换（全部/待结算/已到账）
- 佣金记录列表（订单号、产品、金额、比例、状态）
- 明细展开（基础佣金/厂家奖金/物流返佣/PK奖池/平台红包）
- 到账时间/预计到账展示
- 结算说明文案

**未完成：**
- 佣金导出功能（Excel/PDF）

**进度：80%**

---

### 13. PK奖池

**需求描述：** 展示本周奖池总额（资金来源：平台服务费1%），我的排名与预计奖金，分配规则，Top10排行榜，历史奖池记录。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_pk_pool/jj_pk_pool.vue` |
| 后端控制器 | `JjPkPool.php` → `info()` |
| 数据库表 | `fa_jj_pk_pool`、`fa_jj_pk_rank` |

**已完成：**
- 奖池总额展示（服务端数据，默认值已修正为0）
- 统计周期展示
- 我的排名与预计奖金
- 分配规则说明
- Top10排行榜（含金银铜徽章、高亮自己）
- 历史奖池记录
- 后端完整接口（字段映射已修正）

**未完成：**
- 奖金发放通知
- 奖池每周自动结算（需后端Cron任务）

**进度：75%**

---

### 14. 平台红包

**需求描述：** 每完成一笔结算订单，平台自动发放红包（当前标准¥50/单），红包可抵扣保证金。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `jj_red_packet.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_red_packet/） |
| 后端控制器 | `JjRedPacket.php` → `summary()` / `list()` |
| 数据库表 | `fa_jj_red_packet` |

**已完成：**
- 红包汇总（累计/单数/每单/本月 — 默认值已修正为0）
- 红包规则说明
- 状态Tab（全部/待发放/已到账）
- 红包记录列表
- 后端接口（汇总、列表、抵扣保证金逻辑）

**未完成：**
- 保证金支付页展示可用红包抵扣（前端入口）

**进度：75%**

---

### 15. 心愿目标

**需求描述：** 设定周/月/年订单金额目标，进度条实时显示达成情况，达成后领取平台奖励（现金红包/高价值物品等）。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `jj_wish.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_wish/） |
| 后端控制器 | `JjWish.php` → `current()` / `set_goal()` / `claim_reward()` / `history()` |
| 数据库表 | `fa_jj_wish_goal` |

**已完成：**
- 当前目标展示（类型/金额/进度条/百分比）
- 奖励信息展示
- 设定新目标表单（类型选择/金额输入/奖励描述）
- 领取奖励按钮
- 历史目标记录
- 后端完整接口

**未完成：**
- 高价值奖励审核流程（平台端人工审核）
- 积分兑换系统（需求中提到1000积分=100元）

**进度：75%**

---

### 16. 六边形身价（雷达图）

**需求描述：** 六维度雷达图（成交能力/信誉评分/活跃度/履约率/团队规模/成长速度），动态分数计算，用于工厂筛选居间人。

| 类型 | 文件路径 |
|------|---------|
| 前端组件 | `jj-home-content.vue` 中 `drawRadar()` 方法 |
| 后端控制器 | `JjAgent.php` → `dashboard()` 返回 `hexagonData` |
| 数据库表 | `fa_jj_agent_profile`（六维度字段） |

**已完成：**
- Canvas雷达图绘制（5层同心六边形、轴线、数据区域）
- 6维度标签与分数标注
- 数据从服务端获取
- PC端/移动端响应式适配

**未完成：**
- 需求中六维度为：履约率/成交额/客户评价/响应速度/沟通能力/专业领域，当前实现为：成交能力/信誉评分/活跃度/履约率/团队规模/成长速度（维度名称不完全一致）
- 身价分数动态计算公式（权重配置）
- 工厂端按身价筛选居间人（工厂端功能）

**进度：70%**

---

### 17. 分销推广

**需求描述：** 邀请码、分享海报、邀请人数统计、团队业绩、团队成员列表。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `jj_distribution.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/pages/jj/jj_distribution/） |
| 后端控制器 | `JjDistribution.php` → `team_overview()` / `invite_code()` / `poster()` |
| 数据库表 | `fa_jj_invite`、`fa_jj_agent_profile` |

**已完成：**
- 邀请统计（邀请人数/团队业绩）
- 邀请码展示与复制
- 生成海报按钮
- 团队成员列表
- 后端接口

**未完成：**
- 海报图片生成（Canvas绘制）
- 分销佣金收益明细
- 多级分销层级展示

**进度：70%**

---

### 18. 个人中心（收入看板）

**需求描述：** 用户信息、收入看板（今日待结算/本月已结算/累计）、心愿目标进度、待结算订单列表、功能菜单。

| 类型 | 文件路径 |
|------|---------|
| 前端组件 | `jj-profile-content.vue`（/Users/wujilingtong/CYProject/LanshanNet/xiche111/components/jj-profile-content/） |
| 后端控制器 | `JjAgent.php` → `profile()` |
| 数据库表 | `fa_jj_agent_profile` |

**已完成：**
- 用户信息（头像/昵称/信誉评分）
- 收入看板（今日待结算/本月已结算/累计）
- 心愿目标进度条
- 待结算订单卡片列表
- 功能菜单（佣金明细/心愿目标/PK奖池/平台红包/分销推广/买家管理/账号设置/切换身份/退出登录）
- 编辑资料入口

**未完成：**
- 编辑资料页面（当前提示"功能开发中"）

**进度：80%**

---

### 19. 账号设置

**需求描述：** 修改密码、绑定银行卡、实名信息查看、通知偏好设置。

| 类型 | 文件路径 |
|------|---------|
| 前端页面 | `pages/jj/jj_settings/jj_settings.vue` |
| 后端控制器 | 未独立（复用 `JjAgent.php`） |
| 数据库表 | `fa_user`、`fa_jj_agent_profile` |

**已完成：**
- 页面框架和路由注册

**未完成：**
- 修改密码
- 银行卡绑定管理
- 实名信息查看/修改
- 通知偏好设置

**进度：50%**

---

### 20. 站内即时通讯（IM）

**需求描述：** 基于订单ID的聊天室，支持文字、图片，消息已读回执，聊天记录云端存储，全量日志留存用于纠纷举证。

| 类型 | 文件路径 |
|------|---------|
| 前端 | 无 |
| 后端 | 无 |
| 数据库表 | 无 |

**说明：** 该模块尚未启动开发。需要第三方IM SDK集成（如融云/环信/腾讯IM）。

**进度：0%**

---

### 21. 消息通知与推送

**需求描述：** 订单状态变更通知、平台消息提醒、未完成任务催促、短信/APP推送。

| 类型 | 文件路径 |
|------|---------|
| 前端 | 无（无消息中心页面） |
| 后端 | 无（无推送接口） |
| 数据库表 | 无 |

**说明：** 该模块尚未启动开发。需要消息中心页面、推送服务（极光/个推）、短信网关对接。

**进度：0%**

---

## 三、后端文件清单

| 文件 | 方法数 | 对应功能 |
|------|:------:|---------|
| `JjAgent.php` | 2 | 首页Dashboard、个人资料 |
| `JjProduct.php` | 2 | 商品列表、商品详情 |
| `JjOrder.php` | 8+ | 订单列表/提交/保证金/合同/物流/详情等 |
| `JjBid.php` | 5 | 工厂列表/竞标发布/列表/详情/选定 |
| `JjBuyerInfo.php` | 3 | 买家信息CRUD |
| `JjCommission.php` | 2 | 佣金汇总、列表 |
| `JjPkPool.php` | 1 | PK奖池信息 |
| `JjRedPacket.php` | 3 | 红包汇总/列表/抵扣 |
| `JjWish.php` | 4 | 心愿目标CRUD |
| `JjDistribution.php` | 3 | 分销团队/邀请码/海报 |

---

## 四、数据库表清单

| 表名 | 用途 | Model文件 |
|------|------|----------|
| `fa_jj_agent_profile` | 居间人扩展资料（含六维度评分） | `AgentProfile.php` |
| `fa_jj_product` | 商品/产品信息 | `Product.php` |
| `fa_jj_factory` | 工厂信息 | `Factory.php` |
| `fa_jj_order` | 订单主表 | `Order.php` |
| `fa_jj_order_log` | 订单状态变更日志 | `OrderLog.php` |
| `fa_jj_deposit` | 履约保证金 | `Deposit.php` |
| `fa_jj_contract` | 合同记录 | `Contract.php` |
| `fa_jj_logistics` | 物流信息 | `Logistics.php` |
| `fa_jj_commission` | 佣金记录 | `Commission.php` |
| `fa_jj_bid` | 竞标记录 | `Bid.php` |
| `fa_jj_bid_quote` | 工厂报价 | `BidQuote.php` |
| `fa_jj_buyer_info` | 买家信息管理 | `BuyerInfo.php` |
| `fa_jj_pk_pool` | PK奖池 | `PkPool.php` |
| `fa_jj_pk_rank` | PK排名 | `PkRank.php` |
| `fa_jj_red_packet` | 平台红包 | `RedPacket.php` |
| `fa_jj_invite` | 分销邀请关系 | `Invite.php` |
| `fa_jj_wish_goal` | 心愿目标 | （Db::name直接查询） |

---

## 五、待开发功能优先级建议

### P0 — 核心业务闭环缺失

| 功能 | 说明 |
|------|------|
| 站内即时通讯（IM） | 居间人与工厂沟通的核心通道，需求文档多处引用 |
| 消息通知中心 | 订单状态变更、催促提醒等依赖消息推送 |
| 后端定时任务 | 24h合同逾期自动划转、72h自动结算、PK奖池周结算 |

### P1 — 功能完善

| 功能 | 说明 |
|------|------|
| 账号设置完善 | 银行卡绑定（结算打款依赖）、密码修改 |
| 商品品类筛选 | 商品池筛选UI |
| 检测报告查看 | 商品详情中的检测报告PDF展示 |
| 红包抵扣入口 | 保证金支付页面展示可用红包 |
| 编辑资料页 | 个人中心编辑资料功能 |

### P2 — 体验优化

| 功能 | 说明 |
|------|------|
| 收货地址三级联动 | 买家信息的省市区选择器 |
| 竞标报价横向对比 | 表格视图对比多家工厂 |
| 海报Canvas生成 | 分销推广海报图片 |
| 六维度名称对齐 | 与需求文档中的维度名称统一 |

---

## 六、服务器域名与环境配置

### 1. 前端 API 接口地址

**配置文件：** `xiche111/App.vue`（第37-43行 `globalData`）

| 环境 | API Base URL | 状态 |
|------|-------------|------|
| 生产环境 | `https://xiche.zzlanshan.site/api` | 已配置（当前注释） |
| 本地开发 | `http://localhost:8000/api` | 已配置（当前注释） |
| 局域网测试 | `http://192.168.1.149:8000/api` | **当前激活** |

- **文件存储域名（storageBaseUri）：** 空（未配置，上传图片无法补全域名）
- **OSS上传：** 未启用（`uploadOssStatus: false`）
- **请求调用方式：** `xilu/core.js` 中通过 `getApp().globalData.apiBaseUri` 拼接接口路径

### 2. 后端数据库

**配置文件：** `application/.env`

| 配置项 | 值 |
|--------|-----|
| 主机 | `122.51.106.231` |
| 端口 | `3306` |
| 数据库名 | `andone` |
| 表前缀 | `fa_` |
| 字符集 | `utf8mb4` |

备用本地数据库（已注释）：`127.0.0.1` / `gongxiangxiche`

### 3. MQTT 消息服务（设备通信）

| 配置项 | 值 | 来源文件 |
|--------|-----|---------|
| 服务器（.env） | `110.42.230.141:1883` | `.env` |
| 服务器（config） | `122.51.106.231:1883` | `application/config.php` |
| 认证用户名 | `BNFDfLZjFVjf1` | `application/config.php` |
| keepalive | 60秒 | `application/config.php` |
| 协议 | MQTT（明文，未启用TLS） | — |

订阅主题：`device/+/response`、`device/+/status`、`device/+/event`

实现类：`application/common/library/Mqtt.php`（使用 PhpMqtt\Client）

### 4. 微信配置

#### 4.1 微信小程序

| 配置项 | 值 | 来源 |
|--------|-----|------|
| AppID | `wx81755bfa773bd1b5` | `manifest.json` + `addons/epay/config.php` |
| AppSecret | 数据库 `xiluxc_current_config` 表 `wxmini_secret` 字段 | `addons/xiluxc/library/Config.php` |

#### 4.2 微信公众号

| 配置项 | 来源 |
|--------|------|
| AppID | 数据库 `xiluxc_current_config` 表 `wxpublic_appid` |
| AppSecret | 数据库 `wxpublic_secret` |
| OAuth回调域 | 数据库 `wxpublic_site` |
| OAuth scope | `snsapi_base` |

实现类：`addons/xiluxc/library/wechat/WeixinPublic.php`

#### 4.3 微信支付（V2）

| 配置项 | 值 | 来源文件 |
|--------|-----|---------|
| 商户号 mch_id | `1104122855` | `addons/epay/config.php` |
| API密钥版本 | V2 | `addons/epay/config.php` |
| 证书路径 | `/addons/epay/certs/apiclient_cert.pem` | `addons/epay/config.php` |
| 私钥路径 | `/addons/epay/certs/apiclient_key.pem` | `addons/epay/config.php` |

动态商户配置（数据库加载）：`addons/xiluxc/library/wechat/Payment.php`

### 5. 支付宝配置

**配置文件：** `addons/epay/config.php`（第47-71行）

| 配置项 | 状态 |
|--------|------|
| app_id | **未配置**（空） |
| 私钥 | **未配置**（空） |
| 签名方式 | cert（证书模式） |
| 回调地址 | `/addons/epay/api/notifyx/type/alipay` |
| 返回地址 | `/addons/epay/api/returnx/type/alipay` |

> **注意：** 支付宝支付参数尚未配置，保证金支付页面虽有支付宝选项，但实际无法调起支付。

### 6. 抖音（Douyin）集成

**配置文件：** `application/config.php`（第255-260行）

| 配置项 | 值 |
|--------|-----|
| client_key | `aw60ohtzulw9rk9r` |
| base_url | `https://open.douyin.com` |
| POI ID | `7571901790183065635`、`7187651466377578553` |

实现类：`application/common/library/Douyin.php`

### 7. 地图服务

**配置文件：** `addons/xiluxc/helper.php`（第131-151行）

| 服务商 | API 地址 | 配置方式 |
|--------|---------|---------|
| 百度地图 | `http://api.map.baidu.com/geocoder/v2/` | 数据库 `baidukey` |
| 腾讯地图 | `https://apis.map.qq.com/ws/geocoder/v1/` | 数据库 `tencentkey` |
| 高德地图 | `https://restapi.amap.com/v3/geocode/geo` | 数据库 `amapkey` |

### 8. 邮件服务

**配置文件：** `application/extra/site.php`

| 配置项 | 值 |
|--------|-----|
| SMTP主机 | `smtp.qq.com` |
| SMTP端口 | `465` |
| 验证方式 | SSL/TLS |
| 发件人 | **未配置**（空） |

### 9. 短信服务

**配置文件：** `application/common/library/Sms.php`

- 通过 Hook 机制调用（`sms_send` / `sms_check`）
- 验证码有效期：120秒
- 最大验证次数：10次
- **调试模式：** `app_debug=true` 时接受万能验证码 `123456`

### 10. 文件上传与存储

**配置文件：** `application/extra/upload.php`

| 配置项 | 值 |
|--------|-----|
| 上传接口 | `ajax/upload`（本地） |
| CDN域名 | **未配置**（空） |
| 存储路径 | `/uploads/{year}{mon}{day}/{filemd5}{.suffix}` |
| 最大文件 | 10MB |
| 允许类型 | jpg,png,bmp,jpeg,gif,webp,zip,rar,wav,mp4,mp3,webm |

> **注意：** 未配置OSS云存储（阿里云OSS/七牛/腾讯COS），文件存储在本地服务器。生产环境建议配置 CDN 加速。

### 11. UniApp 应用信息

**配置文件：** `xiche111/manifest.json`

| 配置项 | 值 |
|--------|-----|
| AppID | `__UNI__9C850F5` |
| 微信小程序 AppID | `wx81755bfa773bd1b5` |

### 12. 环境配置待办事项

| # | 待办 | 优先级 |
|---|------|:------:|
| 1 | 前端 `apiBaseUri` 切换为生产域名 `https://xiche.zzlanshan.site/api` | P0 |
| 2 | 配置 `storageBaseUri` 用于图片完整URL拼接 | P0 |
| 3 | 配置支付宝支付参数（app_id/私钥/证书） | P1 |
| 4 | 配置邮件发件人（SMTP账号密码） | P1 |
| 5 | 配置 CDN 域名加速静态资源和上传文件 | P1 |
| 6 | MQTT 启用 TLS 加密（当前明文 1883 端口） | P2 |
| 7 | `app_debug` 上线前关闭（禁用万能验证码） | P0 |
| 8 | SSL 证书部署（Web服务器层面 Nginx/Apache） | P0 |

---

## 七、总结

居间人端前端共 **22个Vue页面/组件**，后端共 **10个API控制器**，关联 **17张数据库表**，涉及 **12个环境配置文件**。

### 项目文件规模统计

| 类别 | 数量 | 关键文件 |
|------|:----:|---------|
| 前端页面/组件 | 22 | `jj_main.vue`、`jj_buyer_form.vue`、`jj_order_detail.vue` 等 |
| 后端API控制器 | 10 | `JjOrder.php`、`JjProduct.php`、`JjBid.php` 等 |
| 数据库Model | 17 | `Order.php`、`Product.php`、`Deposit.php` 等 |
| 环境配置文件 | 12 | 见下表 |

### 环境配置关联文件清单

| # | 配置文件 | 配置内容 |
|---|---------|---------|
| 1 | `xiche111/App.vue` | 前端 API 接口地址（apiBaseUri）、文件存储域名（storageBaseUri） |
| 2 | `xiche111/manifest.json` | UniApp AppID、微信小程序 AppID |
| 3 | `xiche111/xilu/core.js` | HTTP 请求封装、接口拼接逻辑、OSS上传开关 |
| 4 | `application/.env` | 数据库连接（IP/端口/库名/密码）、MQTT服务器 |
| 5 | `application/config.php` | MQTT认证、抖音集成、Token加密、FastAdmin版本 |
| 6 | `application/database.php` | 数据库配置（读取 `.env`） |
| 7 | `application/extra/site.php` | 站点名称、邮件SMTP、备案号、CDN域名、时区 |
| 8 | `application/extra/upload.php` | 文件上传路径、大小限制、允许类型、CDN地址 |
| 9 | `application/extra/addons.php` | 插件注册表 |
| 10 | `addons/epay/config.php` | 微信支付V2（商户号/密钥/证书路径）、支付宝配置 |
| 11 | `addons/xiluxc/library/Config.php` | 微信小程序/公众号密钥（从数据库动态加载） |
| 12 | `addons/xiluxc/helper.php` | 百度/腾讯/高德地图API密钥（从数据库动态加载） |

### 整体进度

核心交易流程（浏览商品 → 接单 → 缴保证金 → 上传合同 → 履约 → 结算）的前后端代码已基本贯通，激励体系（佣金/PK奖池/红包/心愿/分销）也已完成页面和接口的初步对接。

**整体完成度约 65%**，主要差距在于：
1. IM和消息通知两个完整模块未启动（占需求约15%）
2. 各模块的边缘功能和第三方集成（OCR/人脸/电子签/物流API/支付正式环境）未完成
3. 后端定时任务（逾期处理、自动结算）未实现
4. 环境配置尚有多项待完善（支付宝参数、CDN域名、storageBaseUri、app_debug关闭等）
