# 《+1》居间交易平台 — 后台管理系统开发进度评估报告

> 评估时间：2026-02-10
> 需求依据：《+1》平台.xlsx、《+1》居间交易平台页面规划方案.docx

---

## 一、模块总览

| # | 功能模块 | 需求开发进度 |
|---|---------|:-----------:|
| 1 | 居间人认证审核 | 0% |
| 2 | 工厂认证审核 | 0% |
| 3 | 六边形身价管理 | 0% |
| 4 | 双向订单监控 | 0% |
| 5 | 资金结算（五账户托管） | 0% |
| 6 | 结算管理与完税凭证 | 0% |
| 7 | 物流服务配置 | 0% |
| 8 | 物流合规监控 | 0% |
| 9 | 产品信息库与检测报告审核 | 0% |
| 10 | 合同管理（模板+审核+OCR对比） | 0% |
| 11 | PK奖池管理 | 0% |
| 12 | 心愿审核 | 0% |
| 13 | 异常预警系统 | 0% |
| 14 | 数据看板（KPI+热力图） | 0% |
| 15 | 安全与合规 | 0% |
| **综合** | | **约 0%** |

> **说明：** 当前后台管理系统（FastAdmin）拥有完善的基础框架（RBAC权限、管理员管理、通用配置、文件管理等）以及 xiluxc 洗车业务插件的完整管理后台。但**居间交易（jj）业务的管理后台模块尚未启动开发**——无专用的 Admin 控制器、视图、JS文件。以下评估针对居间交易业务的管理需求。

---

## 二、已有基础设施

后台管理系统基于 FastAdmin v1.6.1，以下基础能力已就绪，可直接复用：

| 基础能力 | 文件/模块 | 说明 |
|---------|---------|------|
| RBAC权限体系 | `application/admin/library/Auth.php` | 角色组+权限规则，开箱可用 |
| 管理员管理 | `application/admin/controller/auth/Admin.php` | 管理员增删改查+分组 |
| 权限规则管理 | `application/admin/controller/auth/Rule.php` | 菜单+接口权限配置 |
| 操作日志 | `application/admin/controller/auth/Adminlog.php` | 管理员操作审计 |
| 系统配置 | `application/admin/controller/general/Config.php` | 站点级配置管理 |
| 文件管理 | `application/admin/controller/general/Attachment.php` | 上传文件管理 |
| 仪表盘框架 | `application/admin/controller/Dashboard.php` | 统计面板框架 |
| 支付插件 | `addons/epay/` | 微信支付V2配置已就绪 |
| CRUD代码生成 | `php think crud` | 可根据数据表自动生成管理后台代码 |
| Backend JS框架 | `public/assets/js/require-backend.js` | RequireJS模块体系 |
| AdminLTE模板 | `application/admin/view/layout/` | 后台UI框架 |

### 已有 xiluxc 管理后台规模（非居间业务，仅作参考）

| 类别 | 数量 |
|------|:----:|
| Admin控制器 | 51个 |
| Admin视图 | 152个HTML模板 |
| Backend JS | 45个 |
| 数据Model | 61个 |
| 菜单项 | 1376行菜单定义 |

> 居间交易管理后台可参考 xiluxc 插件的目录结构和代码模式进行开发。

---

## 三、各模块详细评估

---

### 1. 居间人认证审核

**需求描述：** 平台管理员审核居间人注册申请。个人居间人需审核身份证OCR结果和人脸活体检测状态；公司居间人需审核营业执照OCR结果和法人身份证。审核状态：待审核/已通过/已驳回（需填写驳回原因）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/AgentAudit.php`） | 未开发 |
| Admin视图 | 无（需新建 `application/admin/view/jj/agent_audit/`） | 未开发 |
| Backend JS | 无（需新建 `public/assets/js/backend/jj/agent_audit.js`） | 未开发 |
| 数据库表 | `fa_jj_agent_profile`（已存在） | 可复用 |

**未完成：**
- 居间人认证列表页（按审核状态筛选）
- 认证详情页（OCR结果展示、人脸识别状态、证件图片预览）
- 审核操作（通过/驳回+原因）
- 后端审核接口

**进度：0%**

---

### 2. 工厂认证审核

**需求描述：** 平台管理员审核工厂资质提交。查看营业执照（JPG/PNG）、检测报告（PDF）、贸易证书等，通过/驳回操作。工厂信息管理（编辑企业名称/联系人/电话，查看历史订单数和履约率）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/FactoryAudit.php`） | 未开发 |
| Admin视图 | 无（需新建 `application/admin/view/jj/factory_audit/`） | 未开发 |
| Backend JS | 无（需新建 `public/assets/js/backend/jj/factory_audit.js`） | 未开发 |
| 数据库表 | `fa_jj_factory`（已存在） | 可复用 |

**未完成：**
- 工厂认证列表页
- 资质详情页（证件预览、PDF查看）
- 审核操作（通过/驳回）
- 工厂信息编辑页
- 后端审核接口

**进度：0%**

---

### 3. 六边形身价管理

**需求描述：** 配置六维度评分权重公式：履约率（默认30%）、成交额（25%）、客户评价（20%）、响应速度（15%）、沟通能力（5%）、专业领域（5%）。身价排行榜（Top10）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/HexagonConfig.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | `fa_jj_agent_profile`（已存在，含六维度字段） | 可复用 |

**未完成：**
- 评分权重配置页面（6个滑块/输入框）
- 身价排行榜页面（Top10居间人列表）
- 后端权重配置读写接口
- 评分自动计算定时任务

**进度：0%**

---

### 4. 双向订单监控

**需求描述：** 监控两个方向的订单：工厂上架→居间人接单，居间人竞标→工厂报价。订单详情展示基本信息、财务状态（保证金/佣金）、异常标记（红色"违约订单"、黄色"待放款"、红色"风险订单"）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Order.php`） | 未开发 |
| Admin视图 | 无（需新建 `application/admin/view/jj/order/`） | 未开发 |
| Backend JS | 无（需新建 `public/assets/js/backend/jj/order.js`） | 未开发 |
| 数据库表 | `fa_jj_order`、`fa_jj_bid`、`fa_jj_bid_quote`（已存在） | 可复用 |

**未完成：**
- 接单类订单列表（Order ID/居间人/工厂/产品/合同价/佣金比例/状态）
- 竞标类订单列表（Bid ID/居间人/品类/数量/倒计时/状态）
- 订单详情页（基本信息+财务状态+异常标记）
- 24h合同未传 → 自动标红"违约订单"
- 72h未放款 → 自动标黄"待放款"
- 佣金未锁定 → 标红"风险订单"
- 后端订单监控接口

**进度：0%**

---

### 5. 资金结算（五账户托管）

**需求描述：** 核心资金架构，使用信托公司托管账户+子账本体系实现自动分账。五个账户：A=履约保证金（居间人缴纳）、B=工厂佣金（工厂锁定）、C=平台服务费（默认10%）、D=代扣税款（20%-40%）、E=物流返佣。工厂点击"同意放款"或72h倒计时到期时自动触发：B → C+D+E → 居间人账户，A → 退还居间人。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Settlement.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | 无（需新建 `fa_jj_escrow_account`、`fa_jj_settlement` 等） | 未开发 |

**未完成：**
- 五账户实时余额面板
- 自动分账规则配置页面（C/D/E比例设定）
- 信托托管对接（第三方资金托管API）
- 自动分账触发逻辑（72h倒计时）
- 资金流转记录查询

**进度：0%**

---

### 6. 结算管理与完税凭证

**需求描述：** 结算列表（订单ID/居间人/工厂/基础佣金/厂家奖金/物流返佣/代扣个税/实发金额/状态）。自动生成个税缴纳凭证PDF，提供下载。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/SettlementList.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | `fa_jj_commission`（已存在，含基础字段） | 部分可用 |

**未完成：**
- 结算列表页（含状态筛选：待结算/已打款/打款失败）
- 完税凭证PDF自动生成
- 凭证下载接口（居间人端可调用）
- 结算批量操作（批量打款）

**进度：0%**

---

### 7. 物流服务配置

**需求描述：** 配置三级物流类型：极速达、佣金王、省钱王。配置各类型的基础运费模板（按重量/地区计费）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Logistics.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | 无（需新建 `fa_jj_logistics_type`、`fa_jj_shipping_rate` 等） | 未开发 |

**未完成：**
- 物流类型管理页（三级类型CRUD）
- 运费模板配置（按重量/地区/距离阶梯计费）
- 物流返佣比例设定
- 后端物流配置接口

**进度：0%**

---

### 8. 物流合规监控

**需求描述：** 强制使用平台物流检查（未使用平台物流的订单不得进入结算），违规订单标红"违规订单"。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（可集成到订单监控模块） | 未开发 |

**未完成：**
- 物流合规检查逻辑
- 违规订单标记与列表
- 结算拦截规则

**进度：0%**

---

### 9. 产品信息库与检测报告审核

**需求描述：** 审核工厂上传的PDF检测报告（通过/驳回，未审核产品不可上架）。工艺标准富文本查看/编辑。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Product.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | `fa_jj_product`（已存在） | 可复用 |

**未完成：**
- 检测报告审核列表
- PDF在线预览
- 审核操作（通过/驳回）
- 工艺标准查看/编辑
- 产品上架拦截（报告未审核不可上架）

**进度：0%**

---

### 10. 合同管理（模板+审核+OCR对比）

**需求描述：**
- 标准化模板配置：履约保证协议模板编辑器（富文本，支持动态变量 {居间人名称}/{工厂名称}/{佣金总额}/{保证金金额}）
- 正式合同审核：合同列表（订单ID/居间人/工厂/上传时间/文件名/状态），PDF格式校验+10MB限制，通过/驳回（下拉原因）
- 佣金一致性校验：OCR提取合同中的佣金金额，与工厂锁定金额自动对比，差异触发黄色"佣金异常"标记
- 电子签集成（可选）：腾讯电子签API双方签署，状态同步

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Contract.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | `fa_jj_contract`（已存在，基础字段） | 部分可用 |

**未完成：**
- 协议模板富文本编辑器（支持动态变量插入）
- 合同审核列表与详情页
- PDF在线预览与格式校验
- OCR佣金金额提取与自动对比
- 佣金异常标记与处理流程
- 电子签集成（腾讯电子签API）
- 24h超时自动转移保证金逻辑

**进度：0%**

---

### 11. PK奖池管理

**需求描述：** 奖池配置：资金来源=平台服务费的10%，分配规则=Top10居间人按交易量比例分配。每周更新展示"上周奖池X元"。排行榜：Top10居间人+交易额+奖金。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/PkPool.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | `fa_jj_pk_pool`、`fa_jj_pk_rank`（已存在） | 可复用 |

**未完成：**
- 奖池参数配置页（资金来源比例、分配规则）
- 奖池列表与详情
- 排行榜管理
- 每周自动结算定时任务
- 奖金发放记录

**进度：0%**

---

### 12. 心愿审核

**需求描述：** 心愿申请列表（居间人ID/目标/达成状态/奖励内容/审核状态）。审核操作：通过→平台采购奖励+线下交付，驳回→填写原因通知居间人。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Wish.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| 数据库表 | `fa_jj_wish_goal`（已存在） | 可复用 |

**未完成：**
- 心愿申请列表（按状态筛选）
- 审核详情页（目标达成验证）
- 审核操作（通过/驳回+原因）
- 奖励采购与交付跟踪

**进度：0%**

---

### 13. 异常预警系统

**需求描述：** 24h合同未上传→自动划转保证金给工厂，订单状态变"违约"。合规审计日志（按银发[2025]77号文要求记录资金流向和操作人）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Alert.php`） | 未开发 |
| 后端定时任务 | 无（需新建 Cron Command） | 未开发 |
| 数据库表 | 无（需新建 `fa_jj_alert_log`、`fa_jj_audit_log` 等） | 未开发 |

**未完成：**
- 异常预警面板（合同超时/佣金未锁定/放款超时）
- 24h合同超时自动划转定时任务
- 72h放款超时自动触发定时任务
- 合规审计日志（操作人/时间/IP/操作内容）
- 全链路追溯（发布→保证金→合同→发货→结算）

**进度：0%**

---

### 14. 数据看板（KPI+热力图）

**需求描述：**
- 核心KPI卡片：保证金缴纳率、合同上传率、结算完成率、A/B/C/D/E账户实时余额
- 激励效果分析：基础佣金总额、厂家奖金总额、物流返佣总额、PK奖池支出、心愿奖励数量
- 居间人活跃度：日活数、月新增数、高身价占比（评分>=80）
- 全国热力图：订单地理分布，颜色深度=订单密度，可点击弹窗（企业名/产品/佣金比例），支持时间+行业筛选

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Dashboard.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |
| Backend JS | 无（需引入 ECharts 等图表库） | 未开发 |

**未完成：**
- KPI概览面板
- 激励效果分析图表
- 居间人活跃度报表
- 全国热力图（地理分布+交互弹窗+筛选器）
- 后端聚合统计接口

**进度：0%**

---

### 15. 安全与合规

**需求描述：** 法律免责声明管理（注册协议编辑器，支持动态变量 {居间人}/{工厂}，插入"居间人=团体非职业"条款）。敏感操作日志（资金划转、合同删除、用户封禁等）。

| 类型 | 文件路径 | 状态 |
|------|---------|:----:|
| Admin控制器 | 无（需新建 `application/admin/controller/jj/Security.php`） | 未开发 |
| Admin视图 | 无 | 未开发 |

**未完成：**
- 协议模板编辑器（富文本+动态变量）
- 敏感操作审计日志查询页面
- 用户封禁/解封管理

**进度：0%**

---

## 四、后端文件清单（需新建）

| # | 文件路径 | 方法 | 对应功能 |
|---|---------|------|---------|
| 1 | `application/admin/controller/jj/AgentAudit.php` | index / detail / approve / reject | 居间人认证审核 |
| 2 | `application/admin/controller/jj/FactoryAudit.php` | index / detail / approve / reject / edit | 工厂认证审核 |
| 3 | `application/admin/controller/jj/HexagonConfig.php` | index / save_weights / leaderboard | 六边形身价管理 |
| 4 | `application/admin/controller/jj/Order.php` | index / detail / bid_list / bid_detail | 双向订单监控 |
| 5 | `application/admin/controller/jj/Settlement.php` | accounts / config / records | 五账户托管配置 |
| 6 | `application/admin/controller/jj/SettlementList.php` | index / detail / batch_pay / tax_cert | 结算管理 |
| 7 | `application/admin/controller/jj/Logistics.php` | types / rate_template / compliance | 物流配置与合规 |
| 8 | `application/admin/controller/jj/Product.php` | index / report_review / craft_edit | 产品与检测报告 |
| 9 | `application/admin/controller/jj/Contract.php` | index / detail / approve / reject / template | 合同管理 |
| 10 | `application/admin/controller/jj/PkPool.php` | index / config / settle / leaderboard | PK奖池管理 |
| 11 | `application/admin/controller/jj/Wish.php` | index / detail / approve / reject | 心愿审核 |
| 12 | `application/admin/controller/jj/Alert.php` | index / audit_log | 异常预警 |
| 13 | `application/admin/controller/jj/Dashboard.php` | kpi / incentive / activity / heatmap | 数据看板 |
| 14 | `application/admin/controller/jj/Security.php` | agreement / sensitive_log / ban | 安全合规 |

每个控制器需配套：
- 视图文件：`application/admin/view/jj/<module>/index.html` 等
- JS文件：`public/assets/js/backend/jj/<module>.js`

---

## 五、数据库变更清单

### 可直接复用的表（17张，居间人端已建）

| 表名 | 管理用途 |
|------|---------|
| `fa_jj_agent_profile` | 居间人认证审核数据源 |
| `fa_jj_factory` | 工厂认证审核数据源 |
| `fa_jj_product` | 产品审核与管理 |
| `fa_jj_order` | 订单监控数据源 |
| `fa_jj_order_log` | 订单全链路追溯 |
| `fa_jj_bid` / `fa_jj_bid_quote` | 竞标订单监控 |
| `fa_jj_deposit` | 保证金状态监控 |
| `fa_jj_contract` | 合同审核管理 |
| `fa_jj_logistics` | 物流合规监控 |
| `fa_jj_commission` | 结算管理数据源 |
| `fa_jj_pk_pool` / `fa_jj_pk_rank` | PK奖池管理 |
| `fa_jj_red_packet` | 红包管理 |
| `fa_jj_wish_goal` | 心愿审核数据源 |
| `fa_jj_invite` | 分销数据查看 |
| `fa_jj_buyer_info` | 买家信息查看 |

### 需新建的表

| 表名 | 用途 |
|------|------|
| `fa_jj_escrow_account` | 五账户（A/B/C/D/E）余额与流水 |
| `fa_jj_settlement` | 结算记录（含扣税/实发/状态） |
| `fa_jj_tax_cert` | 完税凭证记录 |
| `fa_jj_logistics_type` | 物流类型配置（极速达/佣金王/省钱王） |
| `fa_jj_shipping_rate` | 运费模板 |
| `fa_jj_alert_log` | 异常预警记录 |
| `fa_jj_audit_log` | 合规审计日志（全链路） |
| `fa_jj_hexagon_config` | 六维度权重配置 |
| `fa_jj_agreement_template` | 协议模板 |

---

## 六、菜单权限注册（需新增）

需在 `fa_auth_rule` 表中新增居间交易管理菜单树：

```
居间交易管理
├── 用户管理
│   ├── 居间人认证审核
│   ├── 工厂认证审核
│   └── 六边形身价管理
├── 订单管理
│   ├── 接单类订单
│   └── 竞标类订单
├── 资金结算
│   ├── 五账户看板
│   ├── 结算列表
│   └── 完税凭证
├── 物流管理
│   ├── 物流类型配置
│   ├── 运费模板
│   └── 合规监控
├── 信息管理
│   ├── 产品信息库
│   ├── 检测报告审核
│   └── 合同管理
├── 风控与激励
│   ├── PK奖池管理
│   ├── 心愿审核
│   ├── 红包管理
│   └── 异常预警
├── 数据看板
│   ├── KPI概览
│   ├── 激励分析
│   ├── 活跃度报表
│   └── 全国热力图
└── 安全合规
    ├── 协议模板管理
    └── 审计日志
```

---

## 七、待开发功能优先级建议

### P0 — 交易闭环管理

| 功能 | 说明 |
|------|------|
| 居间人认证审核 | 没有审核就无法开放注册 |
| 工厂认证审核 | 没有审核就无法入驻上架 |
| 双向订单监控 | 平台运营的核心管控能力 |
| 异常预警 + 定时任务 | 24h合同超时/72h放款超时自动处理 |

### P1 — 资金安全

| 功能 | 说明 |
|------|------|
| 五账户托管配置 | 资金流转的核心架构 |
| 结算管理与完税凭证 | 合规结算+税务 |
| 合同管理 | 合同审核+OCR对比 |

### P2 — 运营管理

| 功能 | 说明 |
|------|------|
| PK奖池管理 | 激励体系配置与结算 |
| 心愿审核 | 高价值奖励人工审核 |
| 物流服务配置 | 三级物流类型与运费模板 |
| 产品检测报告审核 | 上架质量把控 |

### P3 — 数据分析

| 功能 | 说明 |
|------|------|
| 数据看板 | KPI、热力图、活跃度 |
| 六边形身价管理 | 权重配置与排行 |
| 安全合规 | 协议管理、审计日志 |

---

## 八、开发提效建议

1. **CRUD代码生成：** FastAdmin 提供 `php think crud --table=fa_jj_order --controller=jj/Order` 命令，可根据已有数据表自动生成 Admin 控制器+视图+JS，大幅减少基础代码编写量。

2. **参考 xiluxc 模式：** 现有 xiluxc 管理后台的目录结构（`controller/xiluxc/order/Order.php` → `view/xiluxc/order/` → `js/backend/xiluxc/order/order.js`）可作为居间交易管理后台的标准模板。

3. **复用 FastAdmin 组件：** 文件上传、富文本编辑器、表格分页、数据导出等前端组件已内置，无需重新开发。

---

## 九、总结

后台管理系统针对居间交易业务的管理模块当前**整体完成度 0%**，15个功能模块均未启动开发。

需新建 **14个Admin控制器**、配套 **14组视图模板**、**14个Backend JS文件**，新增 **9张数据库表**，注册约 **30个菜单权限项**。

好消息是：
1. FastAdmin 基础框架完善（RBAC权限、操作日志、配置管理等已就绪）
2. 居间人端已建的 17 张数据库表可直接作为管理后台的数据源
3. 已有 xiluxc 管理后台（51个控制器+152个视图）提供了成熟的代码模式可参考
4. `php think crud` 命令可根据已有数据表自动生成基础管理代码，显著加速开发
